<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Clientes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Inter; margin:0; background:#f7f9fc; color:#0f172a}
    .wrap{max-width:960px; margin:auto; padding:28px 18px 56px}
    a.btn-home{display:inline-flex; gap:8px; align-items:center; padding:10px 14px; border:1px solid #d0d7e2;
      border-radius:12px; color:#0f172a; text-decoration:none; background:white}
    a.btn-home:hover{background:#eef2ff}
    h1{margin:14px 0 18px}
    .muted{color:#64748b; font-size:14px}

    .card{background:#fff; border:1px solid #e4e8f1; border-radius:14px; padding:16px; margin-top:16px;
      box-shadow:0 6px 20px rgba(15,23,42,.05)}
    label{font-size:14px; color:#344054; display:block; margin-bottom:6px}
    input[type="text"]{width:100%; padding:10px 12px; border-radius:10px; border:1px solid #d7dce8; background:#fff; color:#0f172a}
    .actions{display:flex; gap:10px; margin-top:12px}
    .btn{padding:10px 14px; border-radius:10px; border:1px solid #d0d7e2; background:#eef3ff; color:#1a3a8a; text-decoration:none; cursor:pointer}
    .btn.primary{background:#1a3a8a; color:#fff; border-color:#1a3a8a}
    .btn:disabled{opacity:.6; cursor:not-allowed}

    .grid{display:grid; gap:12px; grid-template-columns: 1fr auto}
    .search{display:flex; gap:10px; align-items:center}
    .search input{flex:1}

    table{width:100%; border-collapse:collapse; margin-top:12px; font-size:14px}
    th, td{border-bottom:1px solid #e9edf6; padding:9px 8px; text-align:left}
    tbody tr:hover{background:#f2f6ff}

    /* Flash messages (si usas flash en Flask) */
    .flash{border-radius:10px; padding:10px 12px; margin-top:14px; border:1px solid}
    .flash.success{background:#ecfdf5; color:#065f46; border-color:#a7f3d0}
    .flash.warning{background:#fffbeb; color:#92400e; border-color:#fde68a}
    .flash.danger{background:#fef2f2; color:#991b1b; border-color:#fecaca}
    .flash.info{background:#eff6ff; color:#1e3a8a; border-color:#bfdbfe}
  </style>
</head>
<body>
  <div class="wrap">
    <a class="btn-home" href="{{ url_for('index') }}">← Inicio</a>
    <h1>Clientes</h1>
    <div class="muted">Crea un cliente con su <strong>nombre</strong> y visualiza el listado. Este listado aparece como selector en <em>Registrar Recogida</em>.</div>

    <!-- Mensajes flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash {{ category }}">{{ message|safe }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Formulario de alta -->
    <div class="card">
      <form method="post" action="{{ url_for('clientes_view') }}">
        <label>Nombre del cliente</label>
        <input type="text" name="nombre" placeholder="Ej. ACME S.A.S." required>
        <div class="actions">
          <button class="btn primary" type="submit">Crear cliente</button>
        </div>
      </form>
    </div>

    <!-- Listado + buscador -->
    <div class="card">
      <div class="grid">
        <div class="search">
          <label style="margin:0">Buscar</label>
          <input id="q" type="text" placeholder="Filtrar por nombre…">
        </div>
        <div style="align-self:end; color:#64748b; font-size:14px; text-align:right">
          Total: <strong id="count">{{ clientes|length }}</strong>
        </div>
      </div>

      <table id="tabla">
        <thead>
          <tr>
            <th style="width:120px">ID</th>
            <th>Nombre</th>
          </tr>
        </thead>
        <tbody>
          {% for c in clientes %}
            <tr>
              <td>{{ c.id }}</td>
              <td>{{ c.nombre }}</td>
            </tr>
          {% else %}
            <tr><td colspan="2">Aún no hay clientes registrados.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // Buscador en vivo
    const q = document.getElementById('q');
    const tbody = document.querySelector('#tabla tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    const count = document.getElementById('count');

    q?.addEventListener('input', () => {
      const term = q.value.trim().toLowerCase();
      let visible = 0;
      rows.forEach(tr => {
        const nameCell = tr.children[1]?.textContent?.toLowerCase() || '';
        const match = term === '' || nameCell.includes(term);
        tr.style.display = match ? '' : 'none';
        if (match) visible++;
      });
      count.textContent = visible;
      if (visible === 0 && rows.length > 0) {
        // Si no hay coincidencias, podrías mostrar un “sin resultados”
      }
    });
  </script>
</body>
</html>
